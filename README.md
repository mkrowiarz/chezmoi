# dotfiles

Personal dotfiles managed with [chezmoi](https://chezmoi.io). Supports **Arch Linux** (CachyOS) and **macOS**.

## Quick start

```bash
# 1. Install git and chezmoi
sudo pacman -S git chezmoi          # Arch
brew install git chezmoi            # macOS

# 2. Init from this repo (use HTTPS — no SSH key needed on a fresh machine)
chezmoi init https://github.com/mkrowiarz/chezmoi.git

# 3. Apply configs (only apps that are installed get configured)
chezmoi apply

# 4. Run setup (interactive menu)
cd ~/chezmoi
bash setup.sh
```

After applying, if SSH access to GitHub is available (e.g. via 1Password agent), the remote automatically switches from HTTPS to SSH.

## Structure

```
chezmoi/
├── home/                        # chezmoi source root (maps to ~/)
│   ├── .chezmoi.toml.tmpl       # generates chezmoi config with OS-aware variables
│   ├── dot_direnvrc
│   └── dot_config/
│       ├── fish/                # config.fish, conf.d/, fish_variables, fish_plugins
│       ├── wezterm/             # wezterm.lua.tmpl (fish path templated)
│       ├── kitty/               # kitty.conf.tmpl (fish path templated)
│       ├── starship.toml
│       ├── zellij/
│       ├── astronvim_v5/        # applied to ~/.config/astronvim_v5
│       ├── ghostty/             # ghostty terminal config
│       ├── hypr/                # hyprland config (Linux only)
│       ├── waybar/              # style.css (colors.css generated by matugen)
│       ├── matugen/             # templates for waybar, hyprlock, wofi, dunst, wlogout
│       ├── btop/
│       ├── yazi/
│       ├── eza/
│       └── fastfetch/
├── .chezmoiignore               # skips configs for apps not in PATH
├── setup.sh                     # master entry point
├── setup_distro.sh              # OS detection + pkg_install/aur_install/cask_install
├── setup_fns.sh                 # shared helpers: begin, finished, ask_user, link_dir
├── setup_core.sh                # fish, starship, fonts, git, jujutsu, direnv, fisher
├── setup_essentials.sh          # 1password, bitwarden, rbw, tailscale
├── setup_desktop.sh             # hyprland stack, wezterm, kitty, yazi, greetd, matugen
├── setup_terminal.sh            # zellij, neovim (AstroNvim), vim
├── setup_dev.sh                 # php, rust, python, node, podman, caddy-proxy, harlequin
└── setup_comms.sh               # vesktop, ferdium
```

## Setup scripts

| Script | What it installs |
|-|-|
| `setup_core.sh` | fish, starship, nerd fonts, git, jujutsu, direnv, fisher + plugins |
| `setup_essentials.sh` | 1Password + CLI, Bitwarden, rbw, Tailscale |
| `setup_desktop.sh` | Hyprland stack, waybar, wezterm, kitty, yazi, greetd, matugen |
| `setup_terminal.sh` | zellij, neovim (AstroNvim), vim |
| `setup_dev.sh` | PHP, Rust, Python/uv, Node/fnm, Podman + caddy-proxy, Harlequin, cli tools |
| `setup_comms.sh` | Vesktop (Discord), Ferdium |

## Managed configs

| Config | Notes |
|-|-|
| `fish/` | config.fish, conf.d/, fish_variables, plugins |
| `ghostty/` | templated — theme per OS |
| `wezterm/wezterm.lua` | templated — fish path per OS |
| `kitty/kitty.conf` | templated — fish path per OS |
| `starship.toml` | prompt |
| `zellij/` | terminal multiplexer |
| `astronvim_v5/` | neovim config (lazy-lock.json uses chezmoi create mode) |
| `hypr/` | full hyprland config (Linux only) |
| `waybar/style.css` | static layout; colors.css generated by matugen |
| `matugen/` | templates for waybar, hyprlock, wofi, dunst, wlogout |
| `btop/`, `yazi/`, `eza/`, `fastfetch/` | as-is |
| `systemd/user/caddy-proxy.service` | rootless podman caddy-docker-proxy |

## Conditional application

`.chezmoiignore` uses `lookPath` to skip configs for apps that aren't installed. This means `chezmoi apply` is safe to run on a fresh machine — only configs for available apps are applied. As you install more tools and re-run `chezmoi apply`, their configs get picked up automatically.

## Local dev proxy (caddy-proxy)

`setup_dev.sh` installs a shared [caddy-docker-proxy](https://github.com/lucaslorentz/caddy-docker-proxy) instance running as a rootless podman systemd service. It listens on ports 80/443 and auto-generates trusted HTTPS certs via its local CA.

**Domain convention:** `*.localhost` — resolves to `127.0.0.1` natively on all OSes (RFC 6761), no DNS config needed.

To expose a container, connect it to the `caddy` network and add labels:

```yaml
networks:
  - caddy

labels:
  caddy: myapp.localhost
  caddy.reverse_proxy: "{{upstreams 3000}}"
  caddy.tls: internal
```

The CA cert is trusted system-wide after running `setup_dev.sh`. Most apps will show a green lock for `*.localhost` with no warnings.

**Firefox** uses its own certificate store and requires a one-time manual import:

1. Open Firefox → address bar → `about:preferences#privacy`
2. Scroll to **Certificates** → click **View Certificates**
3. Go to the **Authorities** tab → click **Import**
4. Select this file:
   ```
   ~/.local/share/containers/storage/volumes/caddy_data/_data/caddy/pki/authorities/local/root.crt
   ```
5. Check **"Trust this CA to identify websites"** → OK
6. Restart Firefox

## Wallpapers & theming

Wallpapers live in `~/chezmoi/wallpapers/`. On a fresh install `setup_desktop.sh` copies the default wallpaper and runs matugen automatically.

To switch wallpaper and regenerate all colors:

```bash
swww img ~/chezmoi/wallpapers/NAME.png
matugen image ~/chezmoi/wallpapers/NAME.png
```

This regenerates: waybar colors, hyprlock, wofi, dunst, wlogout styles.

## Template variables

Available in any `.tmpl` file:

| Variable | Linux | macOS |
|-|-|-|
| `.os` | `linux` | `darwin` |
| `.fish` | `/usr/bin/fish` | `/opt/homebrew/bin/fish` |

## Adding new configs

```bash
# Add a file
chezmoi add ~/.config/something/config.toml

# Add as template (for OS-specific content)
chezmoi add --template ~/.config/something/config.toml

# Check what would change
chezmoi diff

# Apply and commit
chezmoi apply
cd ~/chezmoi && git add -A && git commit -m "..." && git push
```
