# dotfiles

Personal dotfiles managed with [chezmoi](https://chezmoi.io). Supports **Arch Linux** (CachyOS) and **macOS**.

## Quick start

```bash
# 1. Install git and chezmoi
sudo pacman -S git chezmoi          # Arch
brew install git chezmoi            # macOS

# 2. Init from this repo (use HTTPS — no SSH key needed on a fresh machine)
chezmoi init https://github.com/mkrowiarz/chezmoi.git

# 3. Apply configs (only apps that are installed get configured)
chezmoi apply

# 4. Run setup (interactive menu)
cd ~/chezmoi
bash setup.sh
```

After applying, if SSH access to GitHub is available (e.g. via 1Password agent), the remote automatically switches from HTTPS to SSH.

## Structure

```
chezmoi/
├── home/                        # chezmoi source root (maps to ~/)
│   ├── .chezmoi.toml.tmpl       # generates chezmoi config with OS-aware variables
│   ├── dot_direnvrc
│   ├── dot_config/
│   │   ├── fish/                # config.fish, conf.d/, fish_variables, fish_plugins
│   │   ├── ghostty/             # ghostty terminal config (templated)
│   │   ├── wezterm/             # wezterm.lua.tmpl (macOS only)
│   │   ├── kitty/               # kitty.conf.tmpl (fish path templated)
│   │   ├── starship.toml
│   │   ├── zellij/
│   │   ├── astronvim_v5/        # applied to ~/.config/astronvim_v5
│   │   ├── hypr/                # hyprland config (Linux only)
│   │   ├── waybar/              # style.css (config + colors generated by matugen)
│   │   ├── matugen/             # templates for waybar, hyprlock, wofi, dunst, wlogout
│   │   ├── btop/
│   │   ├── yazi/
│   │   ├── eza/
│   │   └── fastfetch/
│   └── dot_local/
│       ├── bin/                 # utility scripts (Linux only)
│       │   ├── set-wallpaper    # set wallpaper + regenerate theme colors
│       │   ├── audio-to-default # move audio streams to default sink
│       │   ├── bluetooth-menu   # wofi bluetooth manager
│       │   ├── network-menu     # wofi network/wifi manager
│       │   └── hypr-reload      # reload hyprland + monitor-toggle
│       └── share/
│           ├── applications/    # .desktop files
│           └── caddy-proxy/     # compose.yml
├── wallpapers/                  # wallpaper collection
├── .chezmoiignore               # skips configs for apps not in PATH
├── setup.sh                     # master entry point
├── setup_distro.sh              # OS detection + pkg_install/aur_install/cask_install
├── setup_fns.sh                 # shared helpers: begin, finished, ask_user, link_dir
├── setup_core.sh                # fish, starship, fonts, git, jujutsu, direnv, fisher
├── setup_essentials.sh          # 1password, bitwarden, rbw, tailscale
├── setup_desktop.sh             # hyprland stack, ghostty, kitty, yazi, greetd, matugen
├── setup_terminal.sh            # zellij, neovim (AstroNvim), zed
├── setup_dev.sh                 # rust, python, node, podman, caddy-proxy, harlequin
└── setup_comms.sh               # vesktop, ferdium
```

## Setup scripts

| Script | What it installs |
|-|-|
| `setup_core.sh` | fish, starship, nerd fonts, git, jujutsu, direnv, fisher, fd, fzf, bat, jq, zoxide |
| `setup_essentials.sh` | 1Password + CLI, Bitwarden, rbw, Tailscale |
| `setup_desktop.sh` | Hyprland stack, waybar, ghostty, kitty, yazi, greetd, matugen |
| `setup_terminal.sh` | zellij, neovim (AstroNvim), zed |
| `setup_dev.sh` | Rust, Python/uv, Node/fnm, Podman + caddy-proxy, Harlequin, cli tools |
| `setup_comms.sh` | Vesktop (Discord), Ferdium |

## Managed configs

| Config | Notes |
|-|-|
| `fish/` | config.fish, conf.d/, fish_variables, plugins |
| `ghostty/` | templated — theme per OS |
| `wezterm/wezterm.lua` | templated — macOS only (ignored on Linux) |
| `kitty/kitty.conf` | templated — fish path per OS |
| `starship.toml` | prompt |
| `zellij/` | terminal multiplexer |
| `astronvim_v5/` | neovim config (lazy-lock.json uses chezmoi create mode) |
| `hypr/` | full hyprland config (Linux only) |
| `waybar/style.css` | static layout; config + colors generated by matugen |
| `matugen/` | templates for waybar, hyprlock, wofi, dunst, wlogout |
| `btop/`, `yazi/`, `eza/`, `fastfetch/` | as-is |
| `systemd/user/caddy-proxy.service` | rootless podman caddy-docker-proxy |

## Utility scripts (Linux)

| Script | Description |
|-|-|
| `set-wallpaper <image>` | Set wallpaper, regenerate theme colors, reload UI, update chezmoi source |
| `audio-to-default` | Move all audio streams to default sink (useful after Bluetooth switch) |
| `bluetooth-menu` | Wofi-based Bluetooth manager (used by waybar on-click) |
| `network-menu` | Wofi-based WiFi/network manager (used by waybar on-click) |
| `hypr-reload` | Reload Hyprland config |

## Conditional application

`.chezmoiignore` uses `lookPath` to skip configs for apps that aren't installed. This means `chezmoi apply` is safe to run on a fresh machine — only configs for available apps are applied. As you install more tools and re-run `chezmoi apply`, their configs get picked up automatically.

Wezterm config is additionally ignored on Linux (only applied on macOS).

## Local dev proxy (caddy-proxy)

`setup_dev.sh` installs a shared [caddy-docker-proxy](https://github.com/lucaslorentz/caddy-docker-proxy) instance running as a rootless podman systemd service. It listens on ports 80/443 and auto-generates trusted HTTPS certs via its local CA.

**Domain convention:** `*.localhost` — resolves to `127.0.0.1` natively on all OSes (RFC 6761), no DNS config needed.

To expose a container, connect it to the `caddy` network and add labels:

```yaml
networks:
  - caddy

labels:
  caddy: myapp.localhost
  caddy.reverse_proxy: "{{upstreams 3000}}"
  caddy.tls: internal
```

The CA cert is trusted system-wide after running `setup_dev.sh`. Most apps will show a green lock for `*.localhost` with no warnings.

**Firefox** uses its own certificate store and requires a one-time manual import:

1. Open Firefox → address bar → `about:preferences#privacy`
2. Scroll to **Certificates** → click **View Certificates**
3. Go to the **Authorities** tab → click **Import**
4. Select this file:
   ```
   ~/.local/share/containers/storage/volumes/caddy_data/_data/caddy/pki/authorities/local/root.crt
   ```
5. Check **"Trust this CA to identify websites"** → OK
6. Restart Firefox

## Wallpapers & theming

Wallpapers live in `~/chezmoi/wallpapers/`. On a fresh install `setup_desktop.sh` copies the default wallpaper and runs matugen automatically.

To switch wallpaper and regenerate all colors:

```bash
set-wallpaper ~/chezmoi/wallpapers/NAME.png
```

This sets the wallpaper via swww, regenerates colors for waybar, hyprland, hyprlock, wofi, dunst, and wlogout, reloads Hyprland + waybar + dunst, and updates the chezmoi source with the new colors.

## Template variables

Available in any `.tmpl` file:

| Variable | Linux | macOS |
|-|-|-|
| `.os` | `linux` | `darwin` |
| `.fish` | `/usr/bin/fish` | `/opt/homebrew/bin/fish` |

## Adding new configs

```bash
# Add a file
chezmoi add ~/.config/something/config.toml

# Add as template (for OS-specific content)
chezmoi add --template ~/.config/something/config.toml

# Check what would change
chezmoi diff

# Apply and commit
chezmoi apply
cd ~/chezmoi && git add -A && git commit -m "..." && git push
```
