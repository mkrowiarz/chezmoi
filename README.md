# dotfiles

Personal dotfiles managed with [chezmoi](https://chezmoi.io). Supports **Arch Linux** (CachyOS) and **macOS**.

## Structure

```
chezmoi/
├── home/                        # chezmoi source root (maps to ~/)
│   ├── .chezmoi.toml.tmpl       # generates chezmoi config with OS-aware variables
│   ├── dot_direnvrc
│   └── dot_config/
│       ├── fish/                # config.fish, conf.d/, fish_variables, fish_plugins
│       ├── wezterm/             # wezterm.lua.tmpl (fish path templated)
│       ├── kitty/               # kitty.conf.tmpl (fish path templated)
│       ├── starship.toml
│       ├── zellij/
│       ├── astronvim_v5/        # applied to ~/.config/astronvim_v5
│       ├── hypr/                # hyprland config (Linux only)
│       ├── waybar/              # style.css (colors.css generated by matugen)
│       ├── matugen/             # templates for waybar, hyprlock, wofi, dunst, wlogout
│       ├── btop/
│       ├── yazi/
│       ├── eza/
│       └── fastfetch/
├── wallpapers/                  # wallpaper collection
├── setup.sh                     # master entry point
├── setup_distro.sh              # OS detection + pkg_install/aur_install/cask_install
├── setup_fns.sh                 # shared helpers: begin, finished, ask_user, link_dir
├── setup_core.sh                # fish, starship, fonts, git, jujutsu, direnv, fisher
├── setup_essentials.sh          # 1password, bitwarden, rbw, tailscale
├── setup_desktop.sh             # hyprland stack, wezterm, kitty, yazi, greetd, matugen
├── setup_terminal.sh            # zellij, neovim (AstroNvim), vim
├── home/dot_local/share/caddy-proxy/compose.yml  # caddy-docker-proxy (reference)
│   └── dot_config/systemd/user/caddy-proxy.service
├── setup_dev.sh                 # php, rust, python, node, podman, caddy-proxy, harlequin
└── setup_comms.sh               # vesktop, ferdium
```

## Bootstrap

### Prerequisites

- **Arch**: `sudo pacman -S git chezmoi`
- **macOS**: `brew install git chezmoi`

### Fresh machine setup

```bash
# 1. Init chezmoi from this repo
chezmoi init git@github.com:mkrowiarz/chezmoi.git

# 2. Apply managed configs
chezmoi apply

# 3. Run setup (interactive menu)
cd ~/chezmoi
bash setup.sh

# Or run everything at once
bash setup.sh --all
```

## Setup scripts

| Script | What it installs |
|-|-|
| `setup_core.sh` | fish, starship, nerd fonts, git, jujutsu, direnv, fisher + plugins |
| `setup_essentials.sh` | 1Password + CLI, Bitwarden, rbw, Tailscale |
| `setup_desktop.sh` | Hyprland stack, waybar, wezterm, kitty, yazi, greetd, matugen |
| `setup_terminal.sh` | zellij, neovim (AstroNvim), vim |
| `setup_dev.sh` | PHP, Rust, Python/uv, Node/fnm, Podman + caddy-proxy, Harlequin, cli tools |
| `setup_comms.sh` | Vesktop (Discord), Ferdium |

## Managed configs

| Config | Notes |
|-|-|
| `fish/` | config.fish, conf.d/, fish_variables, plugins |
| `wezterm/wezterm.lua` | templated — fish path per OS |
| `kitty/kitty.conf` | templated — fish path per OS |
| `starship.toml` | prompt |
| `zellij/` | terminal multiplexer |
| `astronvim_v5/` | symlinked to ~/.config/nvim by setup_terminal.sh |
| `hypr/` | full hyprland config (Linux only) |
| `waybar/style.css` | static layout; colors.css generated by matugen |
| `matugen/` | templates for waybar, hyprlock, wofi, dunst, wlogout |
| `btop/`, `yazi/`, `eza/`, `fastfetch/` | as-is |
| `systemd/user/caddy-proxy.service` | rootless podman caddy-docker-proxy |

## Local dev proxy (caddy-proxy)

`setup_dev.sh` installs a shared [caddy-docker-proxy](https://github.com/lucaslorentz/caddy-docker-proxy) instance running as a rootless podman systemd service. It listens on ports 80/443 and auto-generates trusted HTTPS certs via its local CA.

**Domain convention:** `*.localhost` — resolves to `127.0.0.1` natively on all OSes (RFC 6761), no DNS config needed.

To expose a container, connect it to the `caddy` network and add labels:

```yaml
networks:
  - caddy

labels:
  caddy: myapp.localhost
  caddy.reverse_proxy: "{{upstreams 3000}}"
  caddy.tls: internal
```

The CA cert is trusted system-wide after running `setup_dev.sh`. Browsers will show a green lock for `*.localhost` with no warnings.

## Wallpapers & theming

Wallpapers live in `~/chezmoi/wallpapers/`. On a fresh install `setup_desktop.sh` copies the default wallpaper and runs matugen automatically.

To switch wallpaper and regenerate all colors:

```bash
swww img ~/chezmoi/wallpapers/NAME.png
matugen image ~/chezmoi/wallpapers/NAME.png
```

This regenerates: waybar colors, hyprlock, wofi, dunst, wlogout styles.

## Template variables

Available in any `.tmpl` file:

| Variable | Linux | macOS |
|-|-|-|
| `.os` | `linux` | `darwin` |
| `.fish` | `/usr/bin/fish` | `/opt/homebrew/bin/fish` |

## Adding new configs

```bash
# Add a file
chezmoi add ~/.config/something/config.toml

# Add as template (for OS-specific content)
chezmoi add --template ~/.config/something/config.toml

# Check what would change
chezmoi diff

# Apply and commit
chezmoi apply
cd ~/chezmoi && git add -A && git commit -m "..." && git push
```
